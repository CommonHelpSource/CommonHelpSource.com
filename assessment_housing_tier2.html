<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Housing Assessment - CommonHelpSource</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/styles.css">
  <style>
    .summary-section {
      background: var(--bg-color);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 30px;
    }

    .summary-section h2 {
      color: var(--primary-color);
      font-size: 1.2rem;
      margin: 0 0 10px;
    }

    .summary-item {
      display: flex;
      margin-bottom: 8px;
    }

    .summary-label {
      font-weight: 600;
      margin-right: 10px;
      min-width: 200px;
    }

    .summary-value {
      color: var(--text-color);
    }

    /* Dark theme support for summary */
    .dark-theme .summary-section {
      background: #2d2d2d;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="assessment-card">
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-step completed">1</div>
          <div class="progress-step completed">2</div>
          <div class="progress-step active">3</div>
          <div class="progress-step">4</div>
        </div>
        <div class="progress-labels">
          <div class="progress-label completed">Start</div>
          <div class="progress-label completed">Basic Info</div>
          <div class="progress-label active">Details</div>
          <div class="progress-label">Resources</div>
        </div>
      </div>

      <div class="header">
        <h1>Housing Assessment - Tier 2</h1>
        <div class="location-info">
          <div id="zip-display">ZIP Loading...</div>
        </div>
      </div>

      <!-- Tier 1 Summary -->
      <div class="summary-section">
        <h2>Your Previous Responses</h2>
        <div id="tier1-summary"></div>
      </div>

      <form id="housingAssessmentForm">
        <div class="question-group">
          <label>What type of housing assistance are you seeking?</label>
          <select name="assistance_type" required>
            <option value="">Please select...</option>
            <option value="rental">Rental assistance</option>
            <option value="shelter">Shelter placement</option>
            <option value="rapid">Rapid rehousing</option>
            <option value="longterm">Long-term housing</option>
            <option value="unsure">Unsure</option>
          </select>
          <span class="validation-icon">✓</span>
          <div class="validation-message">Please select the type of assistance you need</div>
        </div>

        <div class="question-group">
          <label>Do you have any income at this time?</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" id="income_yes" name="has_income" value="yes" required>
              <label for="income_yes">Yes</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="income_no" name="has_income" value="no">
              <label for="income_no">No</label>
            </div>
          </div>
        </div>

        <div class="question-group">
          <label>Are you currently receiving any government benefits?</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" id="benefits_yes" name="has_benefits" value="yes" required>
              <label for="benefits_yes">Yes</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="benefits_no" name="has_benefits" value="no">
              <label for="benefits_no">No</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="benefits_unsure" name="has_benefits" value="unsure">
              <label for="benefits_unsure">Not Sure</label>
            </div>
          </div>
        </div>

        <div id="validationMessage" class="validation-message">
          Please answer all questions before continuing
        </div>

        <div class="button-group">
          <a href="assessment_housing_tier1.html" class="button secondary-button">Back to Tier 1</a>
          <button type="button" onclick="submitAssessment()" class="button primary-button">Continue to Summary</button>
        </div>
      </form>
    </div>
  </div>

  <script type="module">
    // Function to update location display
    function updateLocationDisplay() {
      const zip = localStorage.getItem('userZipCode');
      const zipDisplay = document.getElementById('zip-display');
      
      if (!zip || !/^\d{5}$/.test(zip)) {
        alert('Please start from the homepage to set your ZIP code.');
        window.location.href = 'index.html';
        return;
      }

      zipDisplay.textContent = `ZIP ${zip}`;
    }

    // Function to display Tier 1 summary
    function displayTier1Summary() {
      const tier1Data = JSON.parse(localStorage.getItem('housingAssessmentTier1'));
      const summaryDiv = document.getElementById('tier1-summary');
      
      if (!tier1Data) {
        alert('Please complete Tier 1 assessment first.');
        window.location.href = 'assessment_housing_tier1.html';
        return;
      }

      const situationMap = {
        homeless: 'Currently homeless',
        shelter: 'Staying in a shelter',
        temporary: 'Temporary housing',
        risk: 'At risk of losing housing',
        stable: 'Stable housing but need assistance'
      };

      const summaryHTML = `
        <div class="summary-item">
          <div class="summary-label">Housing Situation:</div>
          <div class="summary-value">${situationMap[tier1Data.housing_situation]}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Need Emergency Shelter:</div>
          <div class="summary-value">${tier1Data.emergency_shelter === 'yes' ? 'Yes' : 'No'}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Household Size:</div>
          <div class="summary-value">${tier1Data.household_size} ${tier1Data.household_size === '1' ? 'person' : 'people'}</div>
        </div>
      `;

      summaryDiv.innerHTML = summaryHTML;
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      updateLocationDisplay();
      displayTier1Summary();
      
      // Check for dark theme
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
      }

      // Add validation listeners to all form elements
      const form = document.getElementById('housingAssessmentForm');
      const inputs = form.querySelectorAll('select, input[type="radio"]');
      
      inputs.forEach(input => {
        if (input.type === 'radio') {
          input.addEventListener('change', () => validateQuestion(input));
        } else {
          input.addEventListener('change', () => validateQuestion(input));
          input.addEventListener('blur', () => validateQuestion(input));
        }
      });
    });

    // Enhanced form validation
    function validateQuestion(element) {
      const group = element.closest('.question-group');
      const validationIcon = group.querySelector('.validation-icon');
      
      if (element.checkValidity()) {
        group.classList.remove('invalid');
        group.classList.add('valid');
        validationIcon.textContent = '✓';
        validationIcon.classList.remove('invalid');
        validationIcon.classList.add('valid');
        return true;
      } else {
        group.classList.remove('valid');
        group.classList.add('invalid');
        validationIcon.textContent = '!';
        validationIcon.classList.remove('valid');
        validationIcon.classList.add('invalid');
        return false;
      }
    }

    // Enhanced form submission
    window.submitAssessment = function() {
      const form = document.getElementById('housingAssessmentForm');
      const inputs = form.querySelectorAll('select, input[type="radio"]');
      let isValid = true;

      // Validate all inputs
      inputs.forEach(input => {
        if (!validateQuestion(input)) {
          isValid = false;
        }
      });

      if (!isValid) {
        // Scroll to first invalid question
        const firstInvalid = form.querySelector('.question-group.invalid');
        if (firstInvalid) {
          firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        return;
      }

      // Collect form data
      const formData = {
        assistance_type: form.assistance_type.value,
        has_income: form.has_income.value,
        has_benefits: form.has_benefits.value,
        timestamp: new Date().toISOString()
      };

      // Save to localStorage
      localStorage.setItem('housingAssessmentTier2', JSON.stringify(formData));

      // Show success state in progress bar
      const currentStep = document.querySelector('.progress-step.active');
      currentStep.classList.remove('active');
      currentStep.classList.add('completed');
      
      // Animate transition
      setTimeout(() => {
        window.location.href = 'print.html';
      }, 500);
    };
  </script>
</body>
</html> 