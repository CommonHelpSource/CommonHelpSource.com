<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Housing Assessment - Tier 1</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      background: #f9f9f9;
      color: #333;
    }
    .content-wrapper {
      padding: 40px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    form {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin: 15px 0 5px;
    }
    select, textarea, input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      padding: 12px 24px;
      border: none;
      background: #e53935;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background: #c62828;
    }
    .chat-container {
      max-width: 600px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: none;
    }
    .chat-messages {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 20px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 5px;
    }
    .message {
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
    }
    .user-message {
      background: #e3f2fd;
      margin-left: 20px;
    }
    .assistant-message {
      background: #f5f5f5;
      margin-right: 20px;
    }
    .chat-input {
      display: flex;
      gap: 10px;
    }
    .chat-input input {
      flex: 1;
    }
    #loadingIndicator {
      text-align: center;
      color: #666;
      display: none;
    }
  </style>
</head>
<body>
  <!-- Header will be inserted by header.js -->
  <div class="content-wrapper">
    <h1>Housing Assessment â€“ Tier 1</h1>
    
    <!-- Assessment Form -->
    <form id="housingForm">
      <label>1. What is your current housing status?</label>
      <select id="status">
        <option value="">Select...</option>
        <option value="homeless">Currently homeless</option>
        <option value="shelter">Living in a shelter</option>
        <option value="temp">Temporarily with others</option>
        <option value="rent">Renting a home/apartment</option>
        <option value="own">Own my home</option>
      </select>

      <label>2. Are you at risk of eviction in the next 30 days?</label>
      <select id="eviction">
        <option value="">Select...</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
        <option value="unsure">Not sure</option>
      </select>

      <label>3. Do you feel safe in your current housing?</label>
      <select id="safe">
        <option value="">Select...</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>

      <label>4. Do you require accessible housing (e.g., wheelchair access)?</label>
      <select id="access">
        <option value="">Select...</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>

      <button type="submit">Submit Assessment</button>
    </form>

    <!-- Chat Container (hidden by default) -->
    <div id="chatContainer" class="chat-container">
      <div class="chat-messages" id="chatMessages"></div>
      <div id="loadingIndicator">Analyzing your responses...</div>
      <div class="chat-input">
        <input type="text" id="userInput" placeholder="Type your message here...">
        <button onclick="sendUserMessage()">Send</button>
      </div>
    </div>
  </div>

  <script src="assets/js/header.js"></script>
  <script src="assets/js/chat.js"></script>
  <script>
    if (!localStorage.getItem("zip")) {
      alert("ZIP code is required. Returning to homepage.");
      window.location.href = "index.html";
    }

    const form = document.getElementById("housingForm");
    const chatContainer = document.getElementById("chatContainer");
    const chatMessages = document.getElementById("chatMessages");
    const loadingIndicator = document.getElementById("loadingIndicator");

    form.addEventListener("submit", async function(e) {
      e.preventDefault();
      
      // Save the data
      const data = {
        housing_status: document.getElementById("status").value,
        eviction_risk: document.getElementById("eviction").value,
        safe: document.getElementById("safe").value,
        accessibility: document.getElementById("access").value,
      };
      localStorage.setItem("housing_tier1", JSON.stringify(data));

      // Show loading indicator
      loadingIndicator.style.display = "block";
      
      try {
        // Generate initial AI response based on assessment
        const messages = [
          {
            role: "system",
            content: "You are a helpful assistant specializing in housing assistance and resources. Provide specific, actionable feedback based on the assessment answers."
          },
          {
            role: "user",
            content: `Please provide specific housing resources and recommendations based on this assessment:
            - Housing Status: ${data.housing_status}
            - Eviction Risk: ${data.eviction_risk}
            - Safety Concerns: ${data.safe}
            - Accessibility Needs: ${data.accessibility}
            - ZIP Code: ${localStorage.getItem("zip")}
            
            Format your response with clear sections for immediate actions, available resources, and next steps.`
          }
        ];

        const response = await sendMessage(messages);
        
        // Hide the form and show the chat
        form.style.display = "none";
        chatContainer.style.display = "block";
        
        // Display the AI's response
        const messageDiv = document.createElement("div");
        messageDiv.className = "message assistant-message";
        messageDiv.textContent = response.content;
        chatMessages.appendChild(messageDiv);
        
        // Scroll to the bottom of the chat
        chatMessages.scrollTop = chatMessages.scrollHeight;
      } catch (error) {
        console.error('Error:', error);
        alert('Unable to process your assessment at this time. Please try again later.');
      } finally {
        loadingIndicator.style.display = "none";
      }
    });

    async function sendUserMessage() {
      const userInput = document.getElementById("userInput");
      const message = userInput.value.trim();
      
      if (!message) return;
      
      // Display user message
      const userDiv = document.createElement("div");
      userDiv.className = "message user-message";
      userDiv.textContent = message;
      chatMessages.appendChild(userDiv);
      
      // Clear input
      userInput.value = "";
      
      // Show loading
      loadingIndicator.style.display = "block";
      
      try {
        const response = await sendMessage([
          {
            role: "user",
            content: message
          }
        ]);
        
        // Display AI response
        const aiDiv = document.createElement("div");
        aiDiv.className = "message assistant-message";
        aiDiv.textContent = response.content;
        chatMessages.appendChild(aiDiv);
      } catch (error) {
        console.error('Error:', error);
        alert('Unable to send message at this time. Please try again later.');
      } finally {
        loadingIndicator.style.display = "none";
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    }

    // Handle Enter key in chat input
    document.getElementById("userInput").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        e.preventDefault();
        sendUserMessage();
      }
    });
  </script>
</body>
</html>
</html>